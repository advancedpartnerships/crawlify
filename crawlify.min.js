!function(t,n){"function"==typeof define&&define.amd?define([],n):t.crawlify=n()}(this,function(){var t="function"==typeof window.callPhantom,n={counter:0,complete:!0,isCrawling:t,stop:function(t){this.counter+=t||1,this.complete=!1},start:function(){this.counter>0&&this.counter--,0===this.counter&&this.fin()},when:function(t){this.stop();var n=this;t.done(function(){n.start()})},load:function(t){this.counter=0,history.pushState(null,null,t)},fin:t?function(){this.complete=!0,window.callPhantom(this.counter),this.reset&&this.load(this.reset)}:function(){}};if(window.crawlify)for(var i in window.crawlify)n[i]=window.crawlify[i];if(window.crawlify=n,t){var e=window.XMLHttpRequest;window.XMLHttpRequest=function(){var t=new e,i=function(){t.removeEventListener("load",i),t.removeEventListener("error",i),n.start()};t.addEventListener("load",i),t.addEventListener("error",i);var o=t.send;return t.send=function(){return n.stop(),o.apply(this,arguments)},t};var o=window.setTimeout;window.setTimeout=function(t,i){return n.stop(),o(function(){n.start()},i),o.apply(this,arguments)}}return n});